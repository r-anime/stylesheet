language: python
python:
- '3.6'

install:
- pip install -r utils/requirements.txt

# Updates on master go to /r/bih
# All other branches go to /r/bihstaging for testing
# Pull requests are validated only
script:
- |
  if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then
    if [ "$TRAVIS_BRANCH" = "master" ]; then
      python utils/build.py --subreddit_name bih;
    else
      python utils/build.py --subreddit_name bihstaging;
    fi
  else
    python utils/validate.py;
  fi
deploy:
- on:
    all_branches: true
  provider: script
  script: python utils/update.py
  skip_cleanup: true
